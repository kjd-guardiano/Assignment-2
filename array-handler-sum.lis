     1                                  ;Array Handler - Sum
     2                                  ;Katherine Joy Guardiano, 240-3
     3                                  
     4                                  ; ==== Code Area Start ====
     5                                  global sumarray
     6                                  extern scanf ;for calling the function scanf
     7                                  extern printf ;for calling the function printf
     8                                  
     9                                  segment .data
    10                                  ; ==== Message Declarations ====
    11 00000000 537563636573736675-     startmsg db "Successfully reached start of sum section.", 10, 0
    11 00000009 6C6C79207265616368-
    11 00000012 656420737461727420-
    11 0000001B 6F662073756D207365-
    11 00000024 6374696F6E2E0A00   
    12 0000002C 537563636573736675-     endmsg db "Successfully reached end of sum section.", 10, 0
    12 00000035 6C6C79207265616368-
    12 0000003E 656420656E64206F66-
    12 00000047 2073756D2073656374-
    12 00000050 696F6E2E0A00       
    13 00000056 723133206973206375-     decmsg db "r13 is currently %lf.", 10, 0
    13 0000005F 7272656E746C792025-
    13 00000068 6C662E0A00         
    14 0000006D 43757272656E742074-     totalmsg db "Current total is %lf.", 10, 0
    14 00000076 6F74616C2069732025-
    14 0000007F 6C662E0A00         
    15                                  
    16                                  ; ==== Format Declarations ====
    17                                  
    18 00000084 256C6600                floatform db "%lf", 0 ;8-byte float format
    19 00000088 257300                  stringform db "%s", 0 ;string format
    20                                  
    21                                  segment .bss
    22                                  align 64
    23 00000000 <res 40h>               number_input resq 8
    24 00000040 <res 340h>              backuparea resb 832
    25                                  
    26                                  
    27                                  segment .text
    28                                  ; ==== Start of Code ====
    29                                  sumarray:
    30                                  ; ==== Start of Backup ====
    31                                  ;push       rbp                                              ;Save a copy of the stack base pointer
    32                                  ;mov        rbp, rsp                                         ;We do this in order to be 100% compatible with C and C++.
    33                                  ;push       rbx                                              ;Back up rbx
    34                                  ;push       rcx                                              ;Back up rcx
    35                                  ;push       rdx                                              ;Back up rdx
    36                                  ;push       rsi                                              ;Back up rsi
    37                                  ;push       rdi                                              ;Back up rdi
    38                                  ;push       r8                                               ;Back up r8
    39                                  ;push       r9                                               ;Back up r9
    40                                  ;push       r10                                              ;Back up r10
    41                                  ;push       r11                                              ;Back up r11
    42                                  ;push       r12                                              ;Back up r12
    43                                  ;push       r13                                              ;Back up r13
    44                                  ;push       r14                                              ;Back up r14
    45                                  ;push       r15                                              ;Back up r15
    46                                  ;pushf                                                       ;Back up rflags
    47                                  ; ==== End of Backup ====
    48 00000000 4989FE                  mov r14, rdi ;r14 is the array
    49 00000003 4989F7                  mov r15, rsi ;r15 is the count of valid numbers in array
    50                                  
    51 00000006 B800000000              mov rax, 0
    52 0000000B 48BF-                   mov rdi, startmsg
    52 0000000D [0000000000000000] 
    53 00000015 50                      push rax
    54 00000016 E8(00000000)            call printf
    55 0000001B 58                      pop rax
    56                                  
    57 0000001C 4C893425[00000000]      mov [number_input], r14
    58 00000024 48B9-                   mov rcx, number_input ;to point to current element
    58 00000026 [0000000000000000] 
    59 0000002E BA00000000              mov rdx, 0 ;to store sum
    60                                  
    61                                  sumstart:
    62 00000033 4983FDFF                cmp r13, -1
    63 00000037 7422                    je sumdone ;jumps ONLY if equal to "done"
    64                                  
    65                                  
    66                                  ; [TODO] addition here
    67 00000039 F2430F1004EE            movsd xmm0, [r14 + r13*8]
    68 0000003F 4801CA                  add rdx, rcx
    69                                  ; [TODO] addition here
    70                                  
    71 00000042 49FFCD                  dec r13
    72                                  
    73 00000045 4889D0                  mov rax, rdx
    74 00000048 48BF-                   mov rdi, totalmsg
    74 0000004A [6D00000000000000] 
    75 00000052 52                      push rdx
    76 00000053 E8(00000000)            call printf
    77 00000058 5A                      pop rdx
    78 00000059 EBD8                    jmp sumstart
    79                                  
    80                                  sumdone:
    81 0000005B B800000000              mov rax, 0
    82 00000060 48BF-                   mov rdi, endmsg
    82 00000062 [2C00000000000000] 
    83 0000006A 50                      push rax
    84 0000006B E8(00000000)            call printf
    85 00000070 58                      pop rax
    86                                  
    87                                  ; ==== End of Code ====
    88 00000071 C3                      ret
